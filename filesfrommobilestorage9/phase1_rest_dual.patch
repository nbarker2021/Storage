diff --git a/config/flags.py b/config/flags.py\nnew file mode 100644\nindex 0000000..1d37680\n--- /dev/null\n+++ b/config/flags.py\n@@ -0,0 +1,6 @@\n+\n+import os\n+\n+ENABLE_DUAL_RETRIEVAL = os.getenv("ENABLE_DUAL_RETRIEVAL", "0") == "1"\n+ENABLE_DUAL_SHELLS = os.getenv("ENABLE_DUAL_SHELLS", "0") == "1"\n+SNAP_ON_COMPARE = os.getenv("SNAP_ON_COMPARE", "0") == "1"\n
diff --git a/rest/query_endpoint.py b/rest/query_endpoint.py\nnew file mode 100644\nindex 0000000..656e479\n--- /dev/null\n+++ b/rest/query_endpoint.py\n@@ -0,0 +1,37 @@\n+\n+from __future__ import annotations\n+from fastapi import APIRouter, HTTPException\n+from pydantic import BaseModel, Field\n+import numpy as np\n+\n+from config.flags import ENABLE_DUAL_RETRIEVAL, SNAP_ON_COMPARE\n+from retrieval.scorer import ScorerConfig, rerank\n+from retrieval.dual_compare import compare_retrieval\n+\n+router = APIRouter()\n+\n+class QueryBody(BaseModel):\n+    center: list[float] = Field(..., min_items=8, max_items=8)\n+    candidates: list[list[float]]\n+    topk: int = 20\n+    alpha: float = 1.0\n+    beta: float = 0.0\n+\n+METRICS = {\n+    "query_requests_total": 0,\n+    "query_dual_compare_total": 0,\n+}\n+\n+@router.post("/query_budgeted")\n+def query_budgeted(body: QueryBody):\n+    METRICS["query_requests_total"] += 1\n+    q = np.array(body.center, dtype=float)\n+    docs = np.array(body.candidates, dtype=float)\n+    idx, scores = rerank(q, docs, ScorerConfig(alpha=body.alpha, beta=body.beta), topk=body.topk)\n+    result = {"indices": [int(i) for i in idx], "scores": [float(s) for s in scores]}\n+\n+    if ENABLE_DUAL_RETRIEVAL:\n+        METRICS["query_dual_compare_total"] += 1\n+        rep = compare_retrieval(q, docs, topk=body.topk, axes={"version_container":"v14","tenant":"demo","domain":"retrieval"})\n+        result["dual_compare"] = rep\n+    return result\n
diff --git a/rest/shells_endpoint.py b/rest/shells_endpoint.py\nnew file mode 100644\nindex 0000000..4ba51e6\n--- /dev/null\n+++ b/rest/shells_endpoint.py\n@@ -0,0 +1,33 @@\n+\n+from __future__ import annotations\n+from fastapi import APIRouter, HTTPException\n+from pydantic import BaseModel, Field\n+import numpy as np\n+\n+from config.flags import ENABLE_DUAL_SHELLS\n+from shelling.dual_compare_shells import compare_shells\n+\n+router = APIRouter()\n+\n+class ShellsBody(BaseModel):\n+    center: list[float] = Field(..., min_items=8, max_items=8)\n+    neighbors_v14: list[list[float]]\n+    neighbors_legacy: list[list[float]] | None = None\n+\n+METRICS = {\n+    "shell_requests_total": 0,\n+    "shell_dual_compare_total": 0,\n+}\n+\n+@router.post("/build_shells")\n+def build_shells(body: ShellsBody):\n+    METRICS["shell_requests_total"] += 1\n+    center = np.array(body.center, dtype=float)\n+    v14 = np.array(body.neighbors_v14, dtype=float)\n+    leg = np.array(body.neighbors_legacy, dtype=float) if body.neighbors_legacy is not None else None\n+    res = {"ok": True}\n+    if ENABLE_DUAL_SHELLS:\n+        METRICS["shell_dual_compare_total"] += 1\n+        rep = compare_shells(center, v14, leg, axes={"version_container":"v14","tenant":"demo","domain":"shelling"})\n+        res["dual_compare"] = rep\n+    return res\n
diff --git a/tests/test_rest_smoke.py b/tests/test_rest_smoke.py\nnew file mode 100644\nindex 0000000..e3a21e9\n--- /dev/null\n+++ b/tests/test_rest_smoke.py\n@@ -0,0 +1,39 @@\n+\n+from fastapi.testclient import TestClient\n+from fastapi import FastAPI\n+from rest.query_endpoint import router as query_router\n+from rest.shells_endpoint import router as shells_router\n+import os, numpy as np\n+\n+def make_app():\n+    app = FastAPI()\n+    app.include_router(query_router)\n+    app.include_router(shells_router)\n+    return app\n+\n+def test_query_smoke():\n+    os.environ["ENABLE_DUAL_RETRIEVAL"] = "0"\n+    app = make_app()\n+    c = TestClient(app)\n+    body = {\n+        "center": [1,0,0,0,0,0,0,0],\n+        "candidates": np.eye(8).tolist(),\n+        "topk": 3\n+    }\n+    r = c.post("/query_budgeted", json=body)\n+    assert r.status_code == 200\n+    data = r.json()\n+    assert "indices" in data and len(data["indices"]) == 3\n+\n+def test_shells_smoke():\n+    os.environ["ENABLE_DUAL_SHELLS"] = "0"\n+    app = make_app()\n+    c = TestClient(app)\n+    body = {\n+        "center": [1,0,0,0,0,0,0,0],\n+        "neighbors_v14": np.eye(8).tolist()\n+    }\n+    r = c.post("/build_shells", json=body)\n+    assert r.status_code == 200\n+    data = r.json()\n+    assert data["ok"] is True\n