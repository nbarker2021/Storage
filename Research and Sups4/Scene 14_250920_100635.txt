Section 15 ‚Äî Hot-Zone ‚ÄúCaps‚Äù & Œî-Lift Cookbook
Your reversible micro-ops (caps), your legal repairs (Œî-lifts), and how they live inside the loop.
üîπ Warm-up Q&A
Q: What‚Äôs a cap in CQE terms?
A: A local, reversible, one-shot micro-operation dropped on a hot cell (or tiny patch) to neutralize a mirror residual without changing global meaning. Every cap ships with its inverse, proves it (pre‚Üípost‚Üípre), and writes a tiny receipt.
Q: And a Œî-lift?
A: A declared local identity (a repair that isn‚Äôt merely undoable, but equivalent under your model) that improves conditioning or symmetry. Think ‚Äúswap to a dual basis‚Äù, ‚Äúapply a commuting average‚Äù, ‚Äúlocal min-curvature identity‚Äù. Œî-lifts are monotone: they can tighten strict after a pass.
Q: How do they differ in the rails?
A: Caps: reversible, at most one per hot cell, no strict change.
Œî-lifts: identity-preserving but not trivially invertible; allowed to tighten strict after success.
Q: Who decides which to try?
A: The Cap Broker ranks candidates (smallest footprint, biggest residual drop, clean inverse), tries one, re-mirrors. If still hot, it may propose a cookbook Œî-lift.
üîπ Whiteboard ‚Äî Formal shape
Cap (reversible micro-op)
A cap on patch is valid iff:
‚Ä¢ Locality: (small ; default ).
‚Ä¢ Reversibility: s.t. on .
‚Ä¢ Neutral semantics: View outputs outside are unchanged; inside all declared invariants (units, bounds) hold.
‚Ä¢ Mirror improvement: for residual operator .
‚Ä¢ One-shot: A hot cell sees ‚â§1 cap per loop.
Receipt: cap_id, patch, pre_hash, post_hash, inv_hash_ok, Œîresidual.
Œî-lift (declared identity)
A Œî-lift is admissible if:
‚Ä¢ Identity class: for the forward operator (or same ledger-class up to symmetry).
‚Ä¢ Local support: bounded stencil, documented cookbook name.
‚Ä¢ Monotone strict: allows a tighter threshold only after pass.
‚Ä¢ Re-mirror: must reduce residual or unlock a cap-free pass.
Receipt: lift_id, region, invariant_name, proof_note, Œîresidual, strict_new?.
üîπ Bench ‚Äî The core library (starter set)
Below are safe defaults you can enable today. Each entry lists intent, preconditions, inverse/proof, viewer signature, and common pitfalls.
A. Orthonorm-2√ó2 (cap)
‚Ä¢ Intent: Fix local oblique leak; orthonormalize a 2√ó2 slope/edge block.
‚Ä¢ Pre: Finite values; unitless or unit-consistent pair.
‚Ä¢ Inverse/Proof: QR with recorded ; apply to revert. Hash pre/post and verify .
‚Ä¢ Viewer: Local 8√ó8 shows cross-residual pin collapsing; surround shows seam tension drop.
‚Ä¢ Pitfall: Don‚Äôt rotate across unit boundaries.
B. Phase unwrap/re-wrap (cap)
‚Ä¢ Intent: Remove wrap causing mirror ping-pong in phase fields.
‚Ä¢ Pre: Field is phase-valued; neighbor continuity.
‚Ä¢ Inverse/Proof: Store integer wrap ; inverse adds/subtracts .
‚Ä¢ Viewer: Residual ring ‚Üí single dot; shell shows beat suppression.
‚Ä¢ Pitfall: Never apply across discontinuities (edges).
C. Bias repaint + anti-repaint (cap)
‚Ä¢ Intent: Zero a local DC bias that defeats symmetry tests.
‚Ä¢ Pre: Known acceptable DC range; no unit change.
‚Ä¢ Inverse/Proof: Keep bias ; inverse adds back.
‚Ä¢ Viewer: Green island replaces amber saddle; surround tensors align.
‚Ä¢ Pitfall: Don‚Äôt repaint if view contract needs the bias.
D. Swap-pair (cap)
‚Ä¢ Intent: Swap two mis-indexed neighbors (labeling error) deterministically.
‚Ä¢ Pre: Known permutation class; labels recorded.
‚Ä¢ Inverse/Proof: Swap is its own inverse; receipt contains permutation id.
‚Ä¢ Viewer: Residual checkerboard disappears.
‚Ä¢ Pitfall: Don‚Äôt chain swaps‚Äîone cap per cell.
E. Local unitary (cap)
‚Ä¢ Intent: Rephase a 2-component spinor/vector to restore unitarity.
‚Ä¢ Pre: Norm within tolerance; SU(2)/SO(2) neighborhood ok.
‚Ä¢ Inverse/Proof: Store angle ; inverse uses .
‚Ä¢ Viewer: Hot ridge collapses; shell chirality flag quiets.
‚Ä¢ Pitfall: Apply only to designated spin channels.
F. Notch/denotch (cap)
‚Ä¢ Intent: Remove a spurious narrowband spike introduced by view discretization; pair with denotch inverse.
‚Ä¢ Pre: Spike narrower than declared notch width; outside signal of interest.
‚Ä¢ Inverse/Proof: Preserve IIR/FIR taps to reconstruct; check round-trip.
‚Ä¢ Viewer: Spectral hot line vanishes; time-domain mirror stabilizes.
‚Ä¢ Pitfall: Over-notching is erasure ‚Üí forbidden.
G. Sparse‚áÑdense toggle (cap)
‚Ä¢ Intent: Flip between two exactly equivalent encodings (same math, different storage) to defuse a numeric corner.
‚Ä¢ Pre: Lossless map defined; checksums available.
‚Ä¢ Inverse/Proof: Exact codec round-trip.
‚Ä¢ Viewer: Same field, fewer hot specks from rounding.
‚Ä¢ Pitfall: Don‚Äôt combine with any other cap in the same cell.
Œî-Lift cookbook (identity repairs)
L1. Min-curvature identity
‚Ä¢ What: Replace local patch by argmin of subject to same forward outputs (identity on ).
‚Ä¢ Why: Smooths only the nullspace that mirror is hypersensitive to.
‚Ä¢ Proof note: KKT conditions show unchanged; ledger stores Lagrange multipliers.
‚Ä¢ Viewer: Hot speckles ‚Üí smooth green pool; strict tightens a notch.
L2. Symmetry averaging
‚Ä¢ What: Average tile with its dihedral orbit then project back to the invariant subspace used by views.
‚Ä¢ Why: Restores enforced symmetry exactly where the view expects it.
‚Ä¢ Proof note: commutes with group; projection leaves invariant.
‚Ä¢ Viewer: Residual ‚Äúflower‚Äù pattern snaps to uniform.
L3. Kernel dualization
‚Ä¢ What: Swap a filter/operator for its algebraic dual that has identical forward effect under boundary conditions.
‚Ä¢ Why: Better conditioning, same outputs.
‚Ä¢ Proof note: Dual pair documented; unit test proves equality on test bank.
‚Ä¢ Viewer: Surround seam tensors align; shell flags shrink.
L4. Prox-identity (small Œª)
‚Ä¢ What: Apply with an invariant penalty and small that leaves unchanged (identity limit).
‚Ä¢ Why: Damp unstable directions while respecting outputs.
‚Ä¢ Proof note: Taylor bound; outputs within strict tolerance; mirror equal.
‚Ä¢ Viewer: Amber bands fade without topological change.
L5. Fenchel dual swap
‚Ä¢ What: Local swap to dual variables; compute; swap back.
‚Ä¢ Why: Compute in a domain where the mirror is linearized.
‚Ä¢ Proof note: Documented involution; invariant on round-trip.
‚Ä¢ Viewer: Hot cross resolves; caps no longer needed in that cell.
üîπ Three domain vignettes (what it looks like)
Optics (PSF ring artifact)
‚Ä¢ Symptom: Bright ring in residual at (r‚âà2.1Œª/D).
‚Ä¢ Cap: phase unwrap on a 2√ó2 phase patch at ring peak; inverse stored.
‚Ä¢ Re-mirror: Ring collapses to green; one stubborn pixel remains amber.
‚Ä¢ Œî-lift: min-curvature identity on 3√ó3 with PSF constraints.
‚Ä¢ Strict: WFE gate tightens 25 nm ‚Üí 22 nm.
‚Ä¢ Wrap bits: class4=1001 cap4=0100 commit4=1110 strict4=0001.
Thermal (radiative balance glitch)
‚Ä¢ Symptom: Two adjacent tiles disagree on by 3œÉ.
‚Ä¢ Cap: bias repaint of sub-patch to zero DC offset; inverse recorded.
‚Ä¢ Re-mirror: Disagreement drops to <1œÉ; seam still slightly tilted.
‚Ä¢ Œî-lift: kernel dualization (view uses radiosity; swap to exact dual).
‚Ä¢ Strict: ŒîT/tick 1.0 K ‚Üí 0.8 K.
‚Ä¢ Wrap: 1011 / 0011 / 1101 / 0010.
Spin/EM (unitary phase drift)
‚Ä¢ Symptom: SU(2) norm leak 1e-3 on a 2-component spinor.
‚Ä¢ Cap: local unitary rephase with Œ∏=‚àí0.004 rad; inverse noted.
‚Ä¢ Re-mirror: Leak <1e-6; chiral shell beats still present.
‚Ä¢ Œî-lift: symmetry averaging over L/R chiral view orbit.
‚Ä¢ Strict: Coherence time floor raises; BER gate tightens.
‚Ä¢ Wrap: 1000 / 0001 / 1010 / 0100.
üîπ Safety rails (runtime enforced)
‚Ä¢ At most one cap per hot cell per loop.
‚Ä¢ Cap must round-trip (inverse check + hash).
‚Ä¢ Œî-lift must cite invariant and pass canned tests.
‚Ä¢ No strict tightening before a pass.
‚Ä¢ Any erase ‚áí Landauer log. Most runs: 0 erasures.
üîπ Broker policy (how picks happen)
‚Ä¢ Rank by footprint (smaller first).
‚Ä¢ Rank by expected Œîresidual / cost (viewer-trained heuristic).
‚Ä¢ Penalize cap stacking in same neighborhood.
‚Ä¢ Prefer caps over Œî-lifts for first attempt; prefer Œî-lifts if the same motif recurs (structural issue).
‚Ä¢ After stitch, re-mirror the frontier ring; never trust un-remirrored neighbors.
üîπ Terminal ‚Äî What it feels like to use
cap Orthonorm2x2(id:"CAP_QR_2x2") { patch = 2x2; pre=finite; units=compatible do : {Q,R} = qr(X); X := Q·µÄ X undo : X := Q X prove: hash(pre) -> do -> undo == hash(pre) } lift MinCurv(id:"LIFT_MINCURV") { region=3x3; invariant="PSF_eq" do : x* = argmin ||Œîx|| s.t. F(x*)=F(x) prove: KKT log + PSF forward equivalence testbank strict: nrmse <= min(nrmse, nrmse-Œµ) } use tile(5,7) { suggest cap Orthonorm2x2 if residual.xform == "oblique" else lift MinCurv } 
CLI:
cqe run scene.cql --caps=auto --lifts=declared --emit-viewers=all cqe report --tile 5,7 --show wrap,cap,proof,viewer 
üîπ Viewer signatures (so you can spot them)
‚Ä¢ Orthonorm2x2: tiny X-shaped heatblob goes to dot; surround tensor straightens.
‚Ä¢ Phase unwrap: ring-like residual collapses; shell beat map calms.
‚Ä¢ Bias repaint: flatting of a small plateau; gold strict ring often appears next.
‚Ä¢ Min-curv: ‚Äúsandpaper‚Äù noise becomes satin; no change to forward image.
‚Ä¢ Symmetry average: petals ‚Üí disk; dihedral spokes vanish.
‚Ä¢ Kernel dual: same picture, lower edge tension across tiles.
üîπ Anti-patterns to avoid
‚Ä¢ Chaining two caps on the same hot cell in one loop.
‚Ä¢ Using a cap to smuggle a unit change.
‚Ä¢ Calling a Œî-lift ‚Äúidentity‚Äù without a proof note (cookbook + testbank).
‚Ä¢ Tightening strict after a ‚Äúgreen but fragile‚Äù transient (require stability over N repeats).
‚Ä¢ Skipping frontier re-mirrors after stitch flips.
üîπ Exercises
‚Ä¢ Cap-only vs Lift-only: Run a problem twice: first with caps enabled, lifts off; then reverse. Compare total residual, strict deltas, and number of stitch flips.
‚Ä¢ Viewer-guided caps: Train yourself to spot the ‚ÄúX-blob‚Äù and ‚Äúring-wrap‚Äù signatures before the broker acts; confirm your picks match the broker ‚â•80%.
‚Ä¢ Symmetry audit: Intentionally perturb a symmetric tile; fix it only with Symmetry averaging. Verify unchanged on the testbank.
‚Ä¢ Proof hygiene: Delete an inverse from a cap in a sandbox‚Äîwatch the runtime refuse to proceed (good!).
üîπ Where we are now
‚Ä¢ You have a tight catalog of reversible caps and legal Œî-lifts.
‚Ä¢ You know how they‚Äôre selected, proven, viewed, and recorded.
‚Ä¢ You can read a viewer and guess the right cap/Œî-lift by sight.
Next section: Stitching & Parity Looms ‚Äî Hamming-8/4 and Golay-24 on wraps, seam legalization policies, frontier re-mirrors, and how the shell‚Äôs subharmonics warn you before a bad seam spreads.