Doc E â€” Geometry & Octadic Checks (Metrics, Cleanâ€‘Flag, Operational Use)
Purpose: Define the geometry layer and the octadic (2â†’4â†’8) stability checks that gate decisions and inform controllers. This chapter specifies CSVâ€‘first artifacts, formulas/metrics, detector alternatives, cleanâ€‘flag criteria, operational toggles, validators, and worked examples. It preserves the original rigor while remaining fully deterministic and auditable.
E1. Overview
The geometry layer turns token/window sequences into orbit polylines and computes invariant metrics used for stability, tieâ€‘breaks, and promotion. The octadic checker tests whether the relation structure supports clean splits at 2, 4, and 8 communities, yielding a cleanâ€‘flag and quantitative stats used by operators and DFSS.
Outputs (CSVâ€‘first):
â€¢ geometry_cards.csv â€” one row per window/doc with geometry metrics and mirror/null controls.
â€¢ octadic_checks.csv â€” per document (and per candidate graph) with 2â†’4â†’8 statistics and cleanâ€‘flag.
E2. Geometry Pipeline (window â†’ polyline â†’ metrics)
E2.1 Windowing
â€¢ Use BWâ€‘32 windows (default). For text, a window â‰ˆ sentence/paragraph; for signals, a fixed span.
â€¢ Each window produces a set of Atom Cards (meaning/embedding). For geometry, we construct an ordered polyline over points derived from embeddings or symbolic coordinates.
E2.2 Embedding â†’ Plane
â€¢ Choose an embedding space (optional): embed_space_id with embed_spec_hash.
â€¢ Dimensionality reduction (deterministic): PCAâ†’2D (or fixed random seed for tâ€‘SNE/UMAP if expressly allowed).
â€¢ Normalization: translate to zero mean; scale to unit variance per axis.
E2.3 Polyline Construction
â€¢ Order points by token/step index; tieâ€‘break with glyph order.
â€¢ Compute edge list E = {(p_i, p_{i+1})} and sample at fixed arcâ€‘length for stability.
E2.4 Geometry Metrics (recorded in geometry_cards.csv)
For each window:
â€¢ Curved Action proxy (ğ’œ)
â€¢ Terms: 
â€¢ â€–Îºâ€–Â²: integrated squared curvature along the polyline (discrete sum).
â€¢ Div: divergence proxy = mean absolute turnâ€‘angle difference.
â€¢ Cross: #edge crossings; Hull: convex hull area (normalized).
â€¢ Band8: fraction of samples inside the 8â€‘lane angular bands (see E3).
â€¢ Helicity/Writhe: signed/unsigned twist counts under configured projection.
â€¢ Coefficients stored per run in ops.yml.
â€¢ Chirality: sign of oriented area (positive/negative), binned into {L,R,N} used in parity_set.
â€¢ Helicity: net twist sign; Writhe: total twist magnitude.
â€¢ ACI / BCI (Action/Bridge Compactness Indices):
â€¢ ACI = normalized ğ’œ vs median for the doc;
â€¢ BCI = mean edge length / mean bridge length (lower is tighter bridges).
â€¢ Bandâ€‘8 Occupancy: fraction of samples whose polar angle falls into configured 8 equal sectors.
â€¢ Mirror/Null checks:
â€¢ Mirror: recompute metrics under reflection across major axis; significant metric change â†’ mirror_alert=true.
â€¢ Null: add small IID noise (fixed seed); large variance â†’ null_instability=true.
Schema (geometry_cards.csv):
doc_id,window_id,packet_id,orbit_id,ğ’œ,curvature_l2,div,crossings,hull_area,band8,helicity,writhe,chirality_bin,ACI,BCI,mirror_alert,null_instability,coeff_alpha,coeff_beta,coeff_gamma,coeff_delta,coeff_epsilon 
E3. Lane & Band Geometry (link to shells)
â€¢ Lanes: Map angles Î¸âˆˆ[âˆ’Ï€,Ï€) to 8 lanes: lane = floor(((Î¸+Ï€)/(2Ï€))*8)+1.
â€¢ Bandâ€‘8: For each sample angle Î¸, count inâ€‘band if |Î¸ âˆ’ Î¸_lane_center| â‰¤ Î” (Î” fixed per run). Bandâ€‘8 occupancy promotes lane adherence and is rewarded in ğ’œ.
â€¢ Shell coupling: Lanes 1..8 map to shells 1..8; chirality bin contributes to parity_set (L/R/N).
E4. Octadic Checker (2â†’4â†’8 splits)
E4.1 Base Graph
â€¢ Build relation graph G(V,E) where V are Atom Cards and E connect similar items (e.g., Jaccard â‰¥ Ï„ or cosine â‰¥ Ï„). Deterministic threshold Ï„ from ops.yml.
E4.2 Spectral Splits
â€¢ 2â€‘way: compute Laplacian L, eigenvector vâ‚‚ (Fiedler). Split by sign(vâ‚‚).
â€¢ 4â€‘way: recurse spectral split on each part.
â€¢ 8â€‘way: repeat to depth 3.
E4.3 Statistics (computed at each level)
â€¢ cf2, cf4, cf8: cut fractions (cut edges / total edges) at 2, 4, 8.
â€¢ Q2, Q4, Q8: modularity at 2, 4, 8 partitions (normalized 0..1).
â€¢ Monotone lift: require Qâ‚‚ â‰¤ Qâ‚„ â‰¤ Qâ‚ˆ âˆ’ Îµ_Q; small slack Îµ_Q from config.
â€¢ Balance: cluster size variance at each level (prefer balanced splits).
E4.4 Detector Alternatives (voting)
â€¢ Louvain/Leiden community detection.
â€¢ SBM (Stochastic Block Models) with fixed seeds.
â€¢ Vote: clean if spectral AND at least one alternative meets thresholds; otherwise unclean.
E4.5 Cleanâ€‘Flag
â€¢ clean=true if: 
â€¢ cfâ‚‚, cfâ‚„, cfâ‚ˆ â‰¤ Ï„_cf, and
â€¢ Qâ‚‚ â‰¤ Qâ‚„ â‰¤ Qâ‚ˆ âˆ’ Îµ_Q, and
â€¢ balance variance â‰¤ Ï„_var, and
â€¢ (detector vote supports or detector_policy=single_spectral).
â€¢ Unclean otherwise.
Schema (octadic_checks.csv):
doc_id,graph_id,tau_edge,cf2,cf4,cf8,Q2,Q4,Q8,monotone_lift,variance2,variance4,variance8,detector_policy,vote_support,clean_flag 
E5. Operational Use
â€¢ Controller Guidance 
â€¢ If clean_flag=true and Q8 high â†’ DEEPEN (structured progression).
â€¢ If clean_flag=false but Q4 strong â†’ RECALL/REVIEW (repair moves).
â€¢ If cf* high (fragmented) â†’ RAWâ€‘INTAKE with small halfâ€‘steps.
â€¢ Promotion Weighting 
â€¢ stability_score draws from: low crossings, low curvature, high Bandâ€‘8, monotone Q lift, and cleanâ€‘flag.
â€¢ consistency_across_shells uses balance and Bandâ€‘8 lane adherence.
â€¢ DFSS Input 
â€¢ Futures impact ğ’œ, cf*, Q*; AltDFSS consumes these metrics as part of AltScore.
E6. Validators
â€¢ Deterministic Embedding: embedding choice & seed fixed by embed_spec_hash.
â€¢ Polyline Order: must match step index; ties resolved by glyph order.
â€¢ Metric Recompute: recomputing geometry_cards from intake must match row values.
â€¢ Octadic Recompute: reâ€‘running spectral splits yields identical cf*/Q* values.
â€¢ Voting Policy: detector policy recorded; vote reproducible (seeds fixed).
E7. Examples
E7.1 Geometry Card (sample row)
docA,4,1,o:19,0.742,1.83,0.21,2,0.34,0.78,-1,3,R,0.61,0.47,false,false,1.0,0.3,0.4,0.2,0.1 
Interpretation: moderate curvature, low crossings, strong Bandâ€‘8 adherence (0.78), rightâ€‘hand chirality; stable window.
E7.2 Octadic Check (sample row)
docA,g:default,0.35,0.12,0.19,0.22,0.41,0.55,0.68,true,0.09,0.12,0.15,hybrid,true,true 
Interpretation: monotone modularity lift; clean splits; recommend DEEPEN.
E8. Toggles & Ops
â€¢ embed_method: pca2 | tsne2 | umap2 (PCA default; others require fixed seeds)
â€¢ edge_threshold: 0.35 | 0.45 | 0.55
â€¢ detector_policy: spectral | louvain | leiden | sbm | hybrid
â€¢ epsilon_Q: 0.03 (monotone slack)
â€¢ band8_delta: 0.125Ï€ (lane halfâ€‘width)
â€¢ mirror_check: on|off, null_check: on|off
E9. Implementation Sketch
poly = make_polyline(window_atoms) metrics = compute_metrics(poly, ops) write_geometry_card(metrics) G = build_graph(window_atoms, ops.edge_threshold) octa = spectral_2_4_8(G); vote = detector_vote(G, ops) write_octadic_checks(octa, vote) 
E10. Checklist
â€¢ [ ] Deterministic embed spec logged
â€¢ [ ] Polyline order verified
â€¢ [ ] Geometry metrics serialized
â€¢ [ ] Spectral splits & alt detector run
â€¢ [ ] Cleanâ€‘flag computed, stored
â€¢ [ ] Controller recommendation emitted
E11. Notes
â€¢ If embeddings are absent, compute geometry on symbolic coordinates (e.g., shell/lane angles from glyphs). The metrics remain valid.
â€¢ Geometry guidesâ€”not overridesâ€”legality: it feeds stability_score and controller choice; legality still governed by CI, Buffer, SOI, Watchers, Budget, and Contract.
End Doc E â€” Geometry & Octadic Checks.